local LocalPlayer = game:GetService("Players").LocalPlayer
local PlayerGui = LocalPlayer.PlayerGui

local Arenas = workspace.ArenasREAL

local LobbyMain = PlayerGui.Lobby_Main
local PlayButton = LobbyMain["Bottom Middle"].Start
local RoomsParentFrame = PlayerGui.ViewRooms["Middle Middle"].ViewRooms
local RoomsFrame = RoomsParentFrame.Background.PlayerList.Objects


function FindLocalArena()
    local ArenasList = Arenas:GetChildren()

    for _, Arena in ipairs(ArenasList) do
        local AreaTemplate = Arena:FindFirstChild("ArenaTemplate")

        if AreaTemplate then
            if AreaTemplate.Red.Character then
                local Red  = AreaTemplate.Red.Character.Nametag.Frame.Nickname.Text
                local Blue = AreaTemplate.Blue.Character.Nametag.Frame.Nickname.Text

                if Red == LocalPlayer.Name or Blue == LocalPlayer.Name then
                    return AreaTemplate.Important
                end
            end
        end
    end
end

local TicTacToe = {}

function getIndexFromName(name)
    local row = tonumber(string.sub(name, 1, 1))
    local col = 4 - tonumber(string.sub(name, 2, 2))
    return (col - 1) * 3 + row
end

function TicTacToe.uiToBoard(name)
    local board =  {"_", "_", "_", "_", "_", "_", "_", "_", "_"}
    local boardUI

    if name == "Tic Tac Toe" then
        boardUI = PlayerGui.TicTacToe
    else 
        boardUI = PlayerGui.RushTicTacToe
    end

    local teamColor = boardUI["Top Middle Template"].RoundInfo
    if teamColor.TeamColorRed.Visible then
        teamColor = "O"
    else
        teamColor = "X"
    end

    local ArenaWorkspace = FindLocalArena()
    local BoardBlocks = ArenaWorkspace.Drops:GetChildren()

    for _, obj in ipairs(BoardBlocks) do
        local name = obj.Name
        local color = obj.BrickColor

        local symbol
        if color == BrickColor.new("Steel blue") then
            symbol = "X"
        elseif color == BrickColor.new("Persimmon") then
            symbol = "O"
        end

        local index = getIndexFromName(name)
        board[index] = symbol
    end

    print("-----")
    print(board[1].." "..board[2].." "..board[3])
    print("-----")
    print(board[4].." "..board[5].." "..board[6])
    print("-----")
    print(board[7].." "..board[8].." "..board[9])
    print("-----")


    return { ["board"] = board, ["teamColor"] = teamColor } 
end

TicTacToe.uiToBoard("Tic Tac Toe")